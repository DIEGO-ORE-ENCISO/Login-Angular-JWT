import{d,e as b}from"./chunk-3BWJRFRJ.js";import{A as u,Fa as h,Q as m,W as f,kb as l,o as c,p,s as i}from"./chunk-JLIELJDY.js";var a=function(t){return t.comprobando="comprobando",t.autenticado="autenticado",t.noAutenticado="noAutenticado",t}(a||{});var g={baseUrl:"https://efficient-transformation-production-5940.up.railway.app"};var C=(()=>{class t{baseUrl=g.baseUrl;http=f(b);_curretUser=h(null);_authStatus=h(a.comprobando);currentUser=l(()=>this._curretUser());authStatus=l(()=>this._authStatus());constructor(){this.verificarAuthStatus().subscribe()}setAuthentication(r,e){return this._curretUser.set(r),this._authStatus.set(a.autenticado),localStorage.setItem("token",e),!0}login(r,e){let o=`${this.baseUrl}/auth/login`,s={username:r,password:e};return this.http.post(o,s).pipe(i(({usuario:n,token:x})=>(console.log("Estado: autenticado"),this.setAuthentication(n,x))),u(n=>p(()=>n.error.backend_mensaje)))}verificarAuthStatus(){let r=`${this.baseUrl}/auth/validar-token`,e=localStorage.getItem("token");if(!e)return this.logout(),c(!1);let o=new d().set("Authorization",`Bearer ${e}`);return this.http.get(r,{headers:o}).pipe(i(({usuario:s,token:n})=>this.setAuthentication(s,n)),u(()=>(this._authStatus.set(a.noAutenticado),c(!1))))}logout(){localStorage.removeItem("token"),this._curretUser.set(null),this._authStatus.set(a.noAutenticado),console.log("Estado: "+this._authStatus())}register(r){let e=`${this.baseUrl}/auth/register`;return this.http.post(`${e}`,r).pipe(i(({usuario:o,token:s})=>this.setAuthentication(o,s)),u(o=>p(()=>o.error.backend_mensaje)))}static \u0275fac=function(e){return new(e||t)};static \u0275prov=m({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();export{a,C as b};
