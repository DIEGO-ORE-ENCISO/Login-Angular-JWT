import{d as f,e as b}from"./chunk-3BWJRFRJ.js";import{A as u,Fa as p,Q as m,W as d,kb as l,o as c,p as h,s as i}from"./chunk-JLIELJDY.js";var n=function(t){return t.comprobando="comprobando",t.autenticado="autenticado",t.noAutenticado="noAutenticado",t}(n||{});var g={baseUrl:"https://login-backen-jwt-spring-boot.onrender.com"};var C=(()=>{class t{baseUrl=g.baseUrl;http=d(b);_curretUser=p(null);_authStatus=p(n.comprobando);currentUser=l(()=>this._curretUser());authStatus=l(()=>this._authStatus());constructor(){this.verificarAuthStatus().subscribe()}setAuthentication(r,e){return this._curretUser.set(r),this._authStatus.set(n.autenticado),localStorage.setItem("token",e),!0}login(r,e){let o=`${this.baseUrl}/auth/login`,s={username:r,password:e};return this.http.post(o,s).pipe(i(({usuario:a,token:x})=>(console.log("Estado: autenticado"),this.setAuthentication(a,x))),u(a=>h(()=>a.error.backend_mensaje)))}verificarAuthStatus(){let r=`${this.baseUrl}/auth/validar-token`,e=localStorage.getItem("token");if(!e)return this.logout(),c(!1);let o=new f().set("Authorization",`Bearer ${e}`);return this.http.get(r,{headers:o}).pipe(i(({usuario:s,token:a})=>this.setAuthentication(s,a)),u(()=>(this._authStatus.set(n.noAutenticado),c(!1))))}logout(){localStorage.removeItem("token"),this._curretUser.set(null),this._authStatus.set(n.noAutenticado),console.log("Estado: "+this._authStatus())}register(r){let e=`${this.baseUrl}/auth/register`;return this.http.post(`${e}`,r).pipe(i(({usuario:o,token:s})=>this.setAuthentication(o,s)),u(o=>h(()=>o.error.backend_mensaje)))}static \u0275fac=function(e){return new(e||t)};static \u0275prov=m({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();export{n as a,C as b};
